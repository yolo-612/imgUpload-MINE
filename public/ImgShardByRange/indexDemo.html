<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.unpkg.com/axios@1.3.5/dist/axios.min.js"></script>
</head>
<body>
    <img id="img"/>

    <script>
        const p1 = new Promise((resolve, reject) => {
            axios.get('http://localhost:3000', {
                headers: {
                    Range: 'bytes=0-300000',
                },
                responseType: 'arraybuffer'
            }).then((res) => {
                resolve(res.data)
            }).catch((err) => {
                reject(err)
            })
        })
        
        const p2 = new Promise((resolve, reject) => {
            axios.get('http://localhost:3000', {
                headers: {
                    Range: 'bytes=300001-',
                },
                responseType: 'arraybuffer'
            }).then((res) => {
                resolve(res.data)
            }).catch((err) => {
                reject(err)
            })
        })
        // 核心逻辑组合拼接
        Promise.all([p1, p2]).then(res => {
            const [buffer1, buffer2] = res;
            // ArrayBuffer 本身只是存储二进制数据的
            console.log(buffer1, buffer2, '分片情况')

            // 要拼接就要组合，想以字节的方式操作，那就是 Uint8Array 的方式
            const arr = new Uint8Array(buffer1.byteLength + buffer2.byteLength);
            
            const arr1 = new Uint8Array(buffer1);
            arr.set(arr1, 0);
            
            const arr2 = new Uint8Array(buffer2);
            arr.set(arr2, arr1.byteLength);

            console.log(arr.buffer, '组合后')
            
            const blob = new Blob([arr.buffer]);
            const url = URL.createObjectURL(blob);
            
            
            img.src = url;
            
            // 下载功能
            // const link = document.createElement('a');

            // link.href = url;
            // link.download = 'image.jpg';
            // document.body.appendChild(link);
            // link.click();
            // link.addEventListener('click', () => {
            //     link.remove();
            // });
        })
    </script>
</body>
</html>